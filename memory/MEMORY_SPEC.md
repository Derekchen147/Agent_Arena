# OpenClaw 记忆系统规范

## 1. 记忆类型定义

### 1.1 长期记忆 (Long-term Memory)
- **文件名**: `MEMORY.md`
- **内容类型**: 
  - 用户偏好和设置
  - 重要决策和结论
  - Agent 性格特征和行为模式
  - 关键学习和经验教训
  - 持久性关系信息
- **访问控制**: 
  - 仅在直接对话中加载
  - 群聊中不暴露个人长期记忆
  - 每个 Agent 独立的 MEMORY.md

### 1.2 短期记忆 (Short-term Memory)
- **文件名**: `memory/YYYY-MM-DD.md`
- **内容类型**:
  - 日常对话记录
  - 临时事件和上下文
  - 群聊交互详情
  - 实时观察和反应
- **生命周期**: 
  - 按日期自动创建
  - 可配置保留期限
  - 定期审查和归档

### 1.3 群聊上下文 (Group Chat Context)
- **文件名**: `group_context/{group_id}/YYYY-MM-DD.md`
- **内容类型**:
  - 群聊消息摘要
  - Agent 间互动模式
  - 集体决策记录
  - 上下文压缩版本
- **特点**:
  - 共享但可读写分离
  - 支持增量更新
  - 自动压缩和优化

## 2. 记忆操作规范

### 2.1 写入原则
- **"Text > Brain"**: 所有需要持久化的信息必须写入文件
- **分类存储**: 根据信息重要性和持久性选择合适的存储位置
- **原子操作**: 记忆写入应该是原子的，避免部分写入

### 2.2 读取策略
- **会话初始化**: 
  - 读取长期记忆 (如果适用)
  - 读取最近2天的短期记忆
  - 加载相关群聊上下文
- **按需加载**: 大型记忆文件应支持分页或按需加载

### 2.3 更新机制
- **增量更新**: 只追加新信息，避免重写整个文件
- **版本控制**: 重要记忆变更应记录版本信息
- **冲突解决**: 多 Agent 同时写入时的冲突处理策略

## 3. 安全与隐私规范

### 3.1 数据隔离
- 每个 Agent 的记忆数据完全隔离
- 群聊上下文与个人记忆分离存储
- 敏感信息加密存储（可选）

### 3.2 访问控制
- Agent 只能访问自己的记忆
- 群聊上下文遵循最小权限原则
- 外部访问需要明确授权

### 3.3 数据清理
- 自动过期机制
- 手动清理接口
- 审计日志记录

## 4. 性能与优化

### 4.1 存储优化
- 文件大小限制
- 自动压缩历史记录
- 索引和快速检索

### 4.2 内存管理
- 缓存常用记忆片段
- 按需加载大文件
- 内存使用监控

### 4.3 上下文压缩
- 摘要生成算法
- 重要信息提取
- 语义相似度去重

## 5. 维护与监控

### 5.1 心跳维护
- 定期审查记忆内容
- 提取重要信息到长期记忆
- 清理过期或冗余信息

### 5.2 健康检查
- 记忆文件完整性验证
- 存储空间监控
- 性能指标收集

### 5.3 备份与恢复
- 自动备份策略
- 灾难恢复流程
- 数据一致性保证